<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>主题情感分布可视化</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f4f4f4;
      }
      #visualizationCanvas {
        border: 1px solid #ccc;
        background-color: white;
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>主题情感分布（Canvas 可视化）</h1>
    <canvas id="visualizationCanvas"></canvas>

    <script>
      // 1. 嵌入 JSON 数据 (已将您的 JSON 内容粘贴于此)
      // 数据定义 (保持不变)

      // ----------------------------------------------------

      const initialTopics = [
        {
          topic: '自我价值与形象',

          slots: [
            {
              sentence:
                '我是不是就是个废物？别人一战就上岸，我考了四年才勉强考上，现在还是个普通一本，我这辈子是不是完了？',

              slot: '自我怀疑',

              id: 1,

              color: '#B0CFF6',

              sentiment: -0.9,
            },

            {
              sentence: '你对自己很狠，评价的时候只看“比别人差”，不看“自己扛过了什么”。',

              slot: '自我评价标准',

              id: 2,

              color: '#B0CFF6',

              sentiment: -0.7,
            },

            {
              sentence: '你现在有几个典型的“心里陷阱”：',

              slot: '心理陷阱',

              id: 2,

              color: '#B0CFF6',

              sentiment: -0.5,
            },

            {
              sentence: '普通一本 ≠ 这辈子完了',

              slot: '普通一本的价值',

              id: 2,

              color: '#B0CFF6',

              sentiment: 0.1,
            },

            {
              sentence: '你真正值得骄傲的地方',

              slot: '自我骄傲的特质',

              id: 2,

              color: '#B0CFF6',

              sentiment: 0.5,
            },

            {
              sentence: '你不是废物，你只是走了一条更辛苦、更慢热的路线。',

              slot: '自我肯定',

              id: 2,

              color: '#B0CFF6',

              sentiment: 0.8,
            },

            {
              sentence: '我感觉未来找工作好困难，我怕毕业就失业了',

              slot: '就业焦虑',

              id: 3,

              color: '#B0CFF6',

              sentiment: -0.8,
            },

            {
              sentence: '我现在学的是计算机专业',

              slot: '专业选择',

              id: 3,

              color: '#B0CFF6',

              sentiment: 0,
            },

            {
              sentence: '我怕我连死都做不好。',

              slot: '自我伤害的恐惧',

              id: 13,

              color: '#B0CFF6',

              sentiment: -0.9,
            },

            {
              sentence: '我长相普通，家里也没什么钱，我还很胖，我在学校里面不敢跟别人打招呼说话',

              slot: '外貌与自卑',

              id: 17,

              color: '#B0CFF6',

              sentiment: -0.8,
            },

            {
              sentence: '我从来没有谈过恋爱，甚至女生的手都没有牵过',

              slot: '恋爱经历缺乏',

              id: 19,

              color: '#B0CFF6',

              sentiment: -0.7,
            },

            {
              sentence: '我平常没有课的时候，我就只会在宿舍呆着打游戏，也不想去别的地方。',

              slot: '社交孤立',

              id: 21,

              color: '#B0CFF6',

              sentiment: -0.6,
            },

            {
              sentence: '我看到别人情侣一块，我会很羡慕',

              slot: '对情侣的羡慕',

              id: 25,

              color: '#B0CFF6',

              sentiment: -0.7,
            },

            {
              sentence: '我想减肥，你觉得我应该怎么做，我现在170cm，180斤',

              slot: '减肥计划',

              id: 27,

              color: '#B0CFF6',

              sentiment: 0.2,
            },

            {
              sentence: '长得丑就是原罪',

              slot: '外貌歧视',

              id: 35,

              color: '#B0CFF6',

              sentiment: -0.9,
            },

            {
              sentence: '我一照镜子就觉得自己好丑，穿的也土，人也胖',

              slot: '自我形象不满',

              id: 39,

              color: '#B0CFF6',

              sentiment: -0.8,
            },

            {
              sentence: '我晚上很容易失眠',

              slot: '失眠问题',

              id: 103,

              color: '#B0CFF6',

              sentiment: -0.6,
            },

            {
              sentence: '我很容易睡觉的时候乱想，尤其是想我为什么这么普通，过得生活很没有意义',

              slot: '生活意义的质疑',

              id: 105,

              color: '#B0CFF6',

              sentiment: -0.9,
            },
          ],

          color: '#1E77E8',
        },

        {
          topic: '心理健康与压力管理',

          slots: [
            {
              sentence:
                '我是不是就是个废物？别人一战就上岸，我考了四年才勉强考上，现在还是个普通一本，我这辈子是不是完了？',

              slot: '自我怀疑与自卑',

              id: 1,

              color: '#D9C9F0',

              sentiment: -0.9,
            },

            {
              sentence: '你绝对不是废物。',

              slot: '自我肯定',

              id: 2,

              color: '#D9C9F0',

              sentiment: 0.8,
            },

            {
              sentence: '你现在有几个典型的“心里陷阱”：',

              slot: '心理陷阱识别',

              id: 2,

              color: '#D9C9F0',

              sentiment: 0.1,
            },

            {
              sentence: '普通一本 ≠ 这辈子完了',

              slot: '普通学历与未来可能性',

              id: 2,

              color: '#D9C9F0',

              sentiment: 0.5,
            },

            {
              sentence: '允许自己难过，但别在“完了”这一步卡死',

              slot: '情绪管理与接受',

              id: 2,

              color: '#D9C9F0',

              sentiment: 0.3,
            },

            {
              sentence: '如果你有更严重的想法……',

              slot: '严重心理问题识别',

              id: 2,

              color: '#D9C9F0',

              sentiment: -0.7,
            },

            {
              sentence: '我现在学的是计算机专业，我感觉未来找工作好困难，我怕毕业就失业了',

              slot: '就业焦虑',

              id: 3,

              color: '#D9C9F0',

              sentiment: -0.6,
            },

            {
              sentence: '别人都说考研上岸就解放了，为什么我上岸了反而更绝望？',

              slot: '考研后绝望感',

              id: 9,

              color: '#D9C9F0',

              sentiment: -0.7,
            },

            {
              sentence:
                '我特别怕毕业那天一个人搬行李回老家，我怕我爸妈看到我还是这个死样子会失望死，我该怎么办？',

              slot: '毕业后的家庭压力',

              id: 11,

              color: '#D9C9F0',

              sentiment: -0.9,
            },

            {
              sentence:
                '我确实有想过一死了之，但是我连自杀都不敢，我怕我死了我妈会疯，我怕我连死都做不好。',

              slot: '自杀念头与家庭责任',

              id: 13,

              color: '#D9C9F0',

              sentiment: -1.0,
            },

            {
              sentence:
                '我在学校也没什么朋友，我跟同学之间的关系也不好，平时也没有什么活动可以参加，我不知道跟谁说内心的话',

              slot: '社交孤立与情感表达',

              id: 15,

              color: '#D9C9F0',

              sentiment: -0.8,
            },

            {
              sentence:
                '我感觉我的长相普通，甚至说有点丑，我感觉世界是一个巨大的卡颜局，对外貌不好的人来说，恶意真的太大了。',

              slot: '外貌焦虑',

              id: 35,

              color: '#D9C9F0',

              sentiment: -0.9,
            },

            {
              sentence:
                '我刷到别人说‘长得丑就是原罪’，我一照镜子就想把自己脸抓花，我是不是真的没资格被爱？',

              slot: '外貌自卑与自我伤害',

              id: 37,

              color: '#D9C9F0',

              sentiment: -1.0,
            },

            {
              sentence: '我一照镜子就觉得自己好丑，穿的也土，人也胖',

              slot: '自我形象焦虑',

              id: 39,

              color: '#D9C9F0',

              sentiment: -0.9,
            },

            {
              sentence:
                '我长这么大从来没有谈过恋爱，甚至女生的手都没有牵过，我也很少有女性朋友，其实我是很想去谈恋爱，但是我根本找不到',

              slot: '恋爱与社交焦虑',

              id: 19,

              color: '#D9C9F0',

              sentiment: -0.7,
            },

            {
              sentence:
                '我没什么特长，我平常没有课的时候，我就只会在宿舍呆着打游戏，也不想去别的地方。',

              slot: '缺乏特长与社交动力',

              id: 21,

              color: '#D9C9F0',

              sentiment: -0.6,
            },

            {
              sentence: '我想减肥，你觉得我应该怎么做，我现在170cm，180斤',

              slot: '减肥计划与身体焦虑',

              id: 27,

              color: '#D9C9F0',

              sentiment: -0.5,
            },

            {
              sentence: '我晚上很容易失眠',

              slot: '失眠与睡眠问题',

              id: 103,

              color: '#D9C9F0',

              sentiment: -0.7,
            },

            {
              sentence:
                '我很容易睡觉的时候乱想，尤其是想我为什么这么普通，过得生活很没有意义，然后我对茶和咖啡也比较容易过敏，很容易睡不着',

              slot: '睡前焦虑与过敏影响',

              id: 105,

              color: '#D9C9F0',

              sentiment: -0.8,
            },

            {
              sentence: '有哪些舒缓压力的方法呢',

              slot: '压力缓解方法',

              id: 107,

              color: '#D9C9F0',

              sentiment: -0.2,
            },
          ],

          color: '#9366D6',
        },

        {
          topic: '就业与经济压力',

          slots: [
            {
              sentence: '我现在学的是计算机专业，我感觉未来找工作好困难，我怕毕业就失业了',

              slot: '毕业失业担忧',

              id: 3,

              color: '#FFC9A9',

              sentiment: -0.8,
            },

            {
              sentence:
                '我看到身边的同学每个人都收到大厂的offer和工作，压力好大，我怕每次我毕业之后啥也找不到，就失业，辜负父母的期待。',

              slot: '同学就业压力',

              id: 7,

              color: '#FFC9A9',

              sentiment: -0.9,
            },

            {
              sentence: '我怕我爸妈看到我还是这个死样子会失望死，我该怎么办？',

              slot: '父母期待压力',

              id: 11,

              color: '#FFC9A9',

              sentiment: -0.9,
            },

            {
              sentence:
                '我确实有想过一死了之，但是我连自杀都不敢，我怕我死了我妈会疯，我怕我连死都做不好。',

              slot: '极端情绪与经济压力',

              id: 13,

              color: '#FFC9A9',

              sentiment: -1,
            },

            {
              sentence:
                '我在学校也没什么朋友，我跟同学之间的关系也不好，平时也没有什么活动可以参加，我不知道跟谁说内心的话',

              slot: '社交孤立与经济压力',

              id: 15,

              color: '#FFC9A9',

              sentiment: -0.8,
            },

            {
              sentence:
                '我长这么大从来没有谈过恋爱，甚至女生的手都没有牵过，我也很少有女性朋友，其实我是很想去谈恋爱，但是我根本找不到',

              slot: '恋爱与经济压力',

              id: 19,

              color: '#FFC9A9',

              sentiment: -0.7,
            },

            {
              sentence:
                '我没什么特长，我平常没有课的时候，我就只会在宿舍呆着打游戏，也不想去别的地方。',

              slot: '缺乏特长与经济压力',

              id: 21,

              color: '#FFC9A9',

              sentiment: -0.6,
            },

            {
              sentence: '我想减肥，你觉得我应该怎么做，我现在170cm，180斤',

              slot: '减肥与经济压力',

              id: 27,

              color: '#FFC9A9',

              sentiment: -0.5,
            },

            {
              sentence:
                '我感觉我的长相普通，甚至说有点丑，我感觉世界是一个巨大的卡颜局，对外貌不好的人来说，恶意真的太大了。',

              slot: '外貌与经济压力',

              id: 35,

              color: '#FFC9A9',

              sentiment: -0.8,
            },

            {
              sentence:
                '我刷到别人说‘长得丑就是原罪’，我一照镜子就想把自己脸抓花，我是不是真的没资格被爱？',

              slot: '外貌自卑与经济压力',

              id: 37,

              color: '#FFC9A9',

              sentiment: -1,
            },

            {
              sentence: '我一照镜子就觉得自己好丑，穿的也土，人也胖',

              slot: '外貌自卑与经济压力',

              id: 39,

              color: '#FFC9A9',

              sentiment: -0.9,
            },

            {
              sentence: '我晚上很容易失眠',

              slot: '失眠与经济压力',

              id: 103,

              color: '#FFC9A9',

              sentiment: -0.7,
            },

            {
              sentence:
                '我很容易睡觉的时候乱想，尤其是想我为什么这么普通，过得生活很没有意义，然后我对茶和咖啡也比较容易过敏，很容易睡不着',

              slot: '失眠与自我怀疑',

              id: 105,

              color: '#FFC9A9',

              sentiment: -0.9,
            },
          ],

          color: '#FF660C',
        },

        {
          topic: '人际关系与社交',

          slots: [
            {
              sentence: '我现在学的是计算机专业，我感觉未来找工作好困难，我怕毕业就失业了',

              slot: '就业焦虑',

              id: 3,

              color: '#B4E6B4',

              sentiment: -0.8,
            },

            {
              sentence:
                '我看到身边的同学每个人都收到大厂的offer和工作，压力好大，我怕每次我毕业之后啥也找不到，就失业，辜负父母的期待。',

              slot: '同辈压力',

              id: 7,

              color: '#B4E6B4',

              sentiment: -0.9,
            },

            {
              sentence: '别人都说考研上岸就解放了，为什么我上岸了反而更绝望？',

              slot: '考研后的失落',

              id: 9,

              color: '#B4E6B4',

              sentiment: -0.7,
            },

            {
              sentence:
                '我特别怕毕业那天一个人搬行李回老家，我怕我爸妈看到我还是这个死样子会失望死，我该怎么办？',

              slot: '毕业后的孤独感',

              id: 11,

              color: '#B4E6B4',

              sentiment: -0.9,
            },

            {
              sentence:
                '我在学校也没什么朋友，我跟同学之间的关系也不好，平时也没有什么活动可以参加，我不知道跟谁说内心的话',

              slot: '缺乏社交支持',

              id: 15,

              color: '#B4E6B4',

              sentiment: -0.8,
            },

            {
              sentence:
                '我长这么大从来没有谈过恋爱，甚至女生的手都没有牵过，我也很少有女性朋友，其实我是很想去谈恋爱，但是我根本找不到',

              slot: '恋爱缺失',

              id: 19,

              color: '#B4E6B4',

              sentiment: -0.9,
            },

            {
              sentence:
                '我没什么特长，我平常没有课的时候，我就只会在宿舍呆着打游戏，也不想去别的地方。',

              slot: '缺乏兴趣爱好',

              id: 21,

              color: '#B4E6B4',

              sentiment: -0.7,
            },

            {
              sentence: '我想和女生谈恋爱，但是我不知道怎么跟她们交流，以及去哪里认识女生',

              slot: '恋爱社交困难',

              id: 45,

              color: '#B4E6B4',

              sentiment: -0.8,
            },

            {
              sentence: '其实我挺害怕回家的，因为每次回家家里人都会催我相亲',

              slot: '家庭相亲压力',

              id: 47,

              color: '#B4E6B4',

              sentiment: -0.8,
            },

            {
              sentence: '我现在还没有毕业，相亲的时候总是被女方嫌弃',

              slot: '相亲挫败感',

              id: 49,

              color: '#B4E6B4',

              sentiment: -0.9,
            },

            {
              sentence:
                '有没有一些不需要花很多钱就可以参加的社交活动，我也很想交朋友，有人陪我说话',

              slot: '寻找低成本社交活动',

              id: 85,

              color: '#B4E6B4',

              sentiment: -0.2,
            },

            {
              sentence: '我怎么约其他人打呢，就是哪些平时交流比较少的朋友，可以直接叫人家去吗',

              slot: '约人社交困难',

              id: 89,

              color: '#B4E6B4',

              sentiment: -0.5,
            },

            {
              sentence: '其实我的英语水平也不行，我口语很烂，我平常不敢跟人交流，用英语更加不会了',

              slot: '英语交流障碍',

              id: 93,

              color: '#B4E6B4',

              sentiment: -0.8,
            },

            {
              sentence:
                '我感觉我没有在其他人面前展示自己的信心，当然也没有啥可以展示的，例如每次点到我上去介绍自己或者表演节目，我都是摆摆手',

              slot: '缺乏自信',

              id: 97,

              color: '#B4E6B4',

              sentiment: -0.9,
            },
          ],

          color: '#2BBA2B',
        },

        {
          topic: '健康与减肥',

          slots: [
            {
              sentence: '我现在学的是计算机专业，我感觉未来找工作好困难，我怕毕业就失业了',

              slot: '就业焦虑',

              id: 3,

              color: '#F9B3B3',

              sentiment: -0.8,
            },

            {
              sentence:
                '我看到网上天天说前端毕业就失业了，还有哪些上班的天天996，压力很大，身体出一些毛病。',

              slot: '职业压力',

              id: 5,

              color: '#F9B3B3',

              sentiment: -0.7,
            },

            {
              sentence:
                '我看到身边的同学每个人都收到大厂的offer和工作，压力好大，我怕每次我毕业之后啥也找不到，就失业，辜负父母的期待。',

              slot: '就业压力',

              id: 7,

              color: '#F9B3B3',

              sentiment: -0.9,
            },

            {
              sentence: '我想减肥，你觉得我应该怎么做，我现在170cm，180斤',

              slot: '减肥计划',

              id: 27,

              color: '#F9B3B3',

              sentiment: 0.3,
            },

            {
              sentence: '我昨天听了你的建议去健身房，今天练完之后全身酸痛',

              slot: '健身后的酸痛',

              id: 69,

              color: '#F9B3B3',

              sentiment: -0.2,
            },

            {
              sentence: '但是我看到别人的重量都好大，我根本举不起来，像是哑铃我只能据5kg的',

              slot: '健身自卑',

              id: 71,

              color: '#F9B3B3',

              sentiment: -0.6,
            },

            {
              sentence: '昨天我练了手臂还有腿，现在感觉胳膊都抬不起来了，走路也是很痛',

              slot: '健身后的酸痛',

              id: 75,

              color: '#F9B3B3',

              sentiment: -0.5,
            },

            {
              sentence: '但是我感觉确实，运动完之后，心情会好一点',

              slot: '运动后的心情改善',

              id: 77,

              color: '#F9B3B3',

              sentiment: 0.5,
            },

            {
              sentence: '运动和改善心情有帮助吗',

              slot: '运动与心情改善',

              id: 79,

              color: '#F9B3B3',

              sentiment: 0.4,
            },

            {
              sentence: '我晚上很容易失眠',

              slot: '失眠问题',

              id: 103,

              color: '#F9B3B3',

              sentiment: -0.6,
            },

            {
              sentence:
                '我很容易睡觉的时候乱想，尤其是想我为什么这么普通，过得生活很没有意义，然后我对茶和咖啡也比较容易过敏，很容易睡不着',

              slot: '睡前焦虑',

              id: 105,

              color: '#F9B3B3',

              sentiment: -0.8,
            },
          ],

          color: '#EF2628',
        },

        {
          topic: '语言学习与自我提升',

          slots: [
            {
              sentence: '我现在学的是计算机专业，我感觉未来找工作好困难，我怕毕业就失业了',

              slot: '就业焦虑',

              id: 3,

              color: '#D6C3BF',

              sentiment: -0.7,
            },

            {
              sentence: '我们可以做一个“从 0 社交到有可能恋爱”的路线',

              slot: '社交与恋爱计划',

              id: 46,

              color: '#D6C3BF',

              sentiment: 0.5,
            },

            {
              sentence: '其实我挺害怕回家的，因为每次回家家里人都会催我相亲',

              slot: '回家压力',

              id: 47,

              color: '#D6C3BF',

              sentiment: -0.7,
            },

            {
              sentence:
                '有的时候我一直没人说，没人能理解我，同时他们还经常嘲笑我，我表面没有反应，其实我内心很难受的',

              slot: '社交孤独感',

              id: 57,

              color: '#D6C3BF',

              sentiment: -0.85,
            },

            {
              sentence: '对，其实我把心里的话说出来就舒服多了',

              slot: '表达和分享情感',

              id: 57,

              color: '#D6C3BF',

              sentiment: 0.4,
            },

            {
              sentence: '我总是不太敢在别人面前唱',

              slot: '唱歌胆怯',

              id: 61,

              color: '#D6C3BF',

              sentiment: -0.4,
            },

            {
              sentence: '我平均生活费只有1500，每天吃饭开销就要40块',

              slot: '生活费预算',

              id: 65,

              color: '#D6C3BF',

              sentiment: -0.5,
            },

            {
              sentence: '我昨天听了你的建议去健身房，今天练完之后全身酸痛',

              slot: '身体锻炼体验',

              id: 69,

              color: '#D6C3BF',

              sentiment: 0.3,
            },

            {
              sentence: '昨天我练了手臂还有腿，现在感觉胳膊都抬不起来了，走路也是很痛',

              slot: '锻炼后的恢复建议',

              id: 75,

              color: '#D6C3BF',

              sentiment: -0.3,
            },

            {
              sentence: '我和别人说话的时候或者在讲台上的时候，有什么动作可以让我看起来自信一点',

              slot: '提高自信的肢体语言',

              id: 99,

              color: '#D6C3BF',

              sentiment: 0.4,
            },

            {
              sentence: '我想减肥，你觉得我应该怎么做，我现在170cm，180斤',

              slot: '减肥计划',

              id: 27,

              color: '#D6C3BF',

              sentiment: -0.1,
            },

            {
              sentence:
                '我感觉我的长相普通，甚至说有点丑，我感觉世界是一个巨大的卡颜局，对外貌不好的人来说，恶意真的太大了。',

              slot: '外貌焦虑',

              id: 35,

              color: '#D6C3BF',

              sentiment: -0.8,
            },

            {
              sentence: '我很容易睡觉的时候乱想，尤其是想我为什么这么普通，过得生活很没有意义',

              slot: '失眠与乱想',

              id: 105,

              color: '#D6C3BF',

              sentiment: -0.6,
            },

            {
              sentence: '我对茶和咖啡也比较容易过敏，很容易睡不着',

              slot: '饮食敏感性',

              id: 105,

              color: '#D6C3BF',

              sentiment: -0.4,
            },
          ],

          color: '#8C5649',
        },
      ] // ----------------------------------------------------

      // 2. 准备 Canvas
      const canvas = document.getElementById('visualizationCanvas')
      const ctx = canvas.getContext('2d')

      // 3. 定义常量
      const visualizationWidth = 1200
      const stripHeight = 70 // 每条条带的垂直间距
      const topicCount = initialTopics.length
      const maxID = 108 // 数据中 slot.id 的最大值

      // 为 X 轴留出额外的垂直空间 (约 30px)
      const stripYOffset = 50

      // 计算 Canvas 实际所需高度
      const canvasHeight = topicCount * stripHeight + stripYOffset + 20 // 40 为底部额外留白

      canvas.width = visualizationWidth
      canvas.height = canvasHeight

      // 4. 数据预处理：添加模拟情感值 (sentiment)
      const topics = initialTopics

      // 5. 定义 X 轴缩放函数
      const plotStart = 120 // 为主题标签留出空间
      const plotEnd = visualizationWidth - 20
      const plotWidth = plotEnd - plotStart

      function xScale(id) {
        // 将 id (1 到 maxID) 线性映射到绘图区域 (plotStart 到 plotEnd)
        return plotStart + (id / maxID) * plotWidth
      }

      /**
       * 绘制顶部的 X 轴坐标轴
       */
      function drawXAxis() {
        const yAxisTop = 30 // 轴线绘制的 Y 坐标

        ctx.strokeStyle = '#333'
        ctx.lineWidth = 1

        // 1. 绘制水平轴线
        ctx.beginPath()
        ctx.moveTo(plotStart, yAxisTop)
        ctx.lineTo(plotEnd, yAxisTop)
        ctx.stroke()

        ctx.fillStyle = '#333'
        ctx.font = '10px Arial'
        ctx.textAlign = 'center'

        // 2. 确定刻度步长 (例如每 5 个 ID 一个刻度)
        const tickStep = 5

        // 3. 绘制刻度线和标签
        for (let id = 0; id <= maxID; id += tickStep) {
          const x = xScale(id)

          // 绘制垂直刻度线 (5px 长)
          ctx.beginPath()
          ctx.moveTo(x, yAxisTop)
          ctx.lineTo(x, yAxisTop + 5)
          ctx.stroke()

          // 绘制标签 (ID 值)
          // 绘制在轴线的上方
          ctx.fillText(id.toString(), x, yAxisTop - 5)
        }
        ctx.textAlign = 'left' // 恢复默认对齐
      }

      // 6. 绘制函数
      function drawVisualization() {
        // 清空 Canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        // === 绘制 X 轴 ===
        drawXAxis()

        // 循环绘制每个主题条带
        topics.forEach((topic, i) => {
          // yBase 是主题标签的基线/条带的中心线
          const yBase = i * stripHeight + stripYOffset + 30

          // 1. 绘制条带背景 (固定灰色背景，高度 60px)
          ctx.fillStyle = 'lightgray'
          // 从 yBase - 30 (顶部) 到 yBase + 30 (底部)
          ctx.fillRect(0, yBase - 30, visualizationWidth, 60)

          // 2. 绘制主题标签 (在最左侧)
          ctx.fillStyle = 'black'
          ctx.font = '14px Arial'
          ctx.fillText(topic.topic, 10, yBase)

          // 3. 绘制 Slot 情感点
          topic.slots.forEach((slot) => {
            const x = xScale(slot.id)

            // yBase + slot.sentiment * 20: 正情感 (如 1.0) 向上偏移 20px (yBase - 20)
            // 负情感 (如 -1.0) 向下偏移 20px (yBase + 20)
            const y = yBase - slot.sentiment * 20

            // 颜色和透明度逻辑 (来自您的第二种绘图方式)
            let color
            let sentiment = slot.sentiment

            if (sentiment < 0) {
              // 消极情感：红色 (透明度由 1 + sentiment, 即 0 到 1 的绝对值决定)
              color = `rgba(255, 0, 0, ${Math.abs(sentiment)})`
            } else {
              // 积极情感：绿色 (透明度由 sentiment, 即 0 到 1 决定)
              color = `rgba(0, 255, 0, ${sentiment})`
            }

            // --- 绘制光晕点 (半径 20px, 低透明度) ---
            ctx.beginPath()
            ctx.arc(x, y, 20, 0, 2 * Math.PI)
            // 为了安全，手动设置低透明度
            ctx.fillStyle = color.replace(/, 1\)/g, ', 0.3)').replace(')', ', 0.3)')
            ctx.fill()

            // --- 绘制核心点 (半径 10px) ---
            ctx.beginPath()
            ctx.arc(x, y, 10, 0, 2 * Math.PI)
            ctx.fillStyle = color
            ctx.fill()
          })
        })
      }

      drawVisualization()
    </script>
  </body>
</html>
